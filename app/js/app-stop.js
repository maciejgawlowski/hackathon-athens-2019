var TRANSPORT_TYPE = {
    TRAIN: "train",
    CAR: "car",
    ECAR: "electric-car",
    BUS: "bus"
};

var mapStop = L.map('map-stop').setView([37.99, 23.81], 11);

$("#table").hide();
$("#info-form").hide();

var startTrainLine = [{
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933029174804688,
                        37.9241594356582
                    ],
                    [
                        23.92547607421875,
                        37.915763487770754
                    ],
                    [
                        23.91303062438965,
                        37.9125809021964
                    ],
                    [
                        23.901958465576172,
                        37.9085178269131
                    ],
                    [
                        23.898782730102536,
                        37.9093304599207
                    ],
                    [
                        23.88891220092773,
                        37.9241594356582
                    ],
                    [
                        23.88676643371582,
                        37.9306588660664
                    ],
                    [
                        23.886165618896484,
                        37.960237554157786
                    ],
                    [
                        23.88376235961914,
                        37.9662601295399
                    ],
                    [
                        23.87054443359375,
                        37.979724550378606
                    ],
                    [
                        23.86977195739746,
                        37.98283657763338
                    ],
                    [
                        23.872604370117188,
                        37.99345706804981
                    ],
                    [
                        23.872861862182617,
                        37.99487752662492
                    ],
                    [
                        23.86908531188965,
                        38.007051757423675
                    ],
                    [
                        23.8677978515625,
                        38.01381434563611
                    ],
                    [
                        23.865909576416016,
                        38.016654446651685
                    ],
                    [
                        23.862476348876953,
                        38.01935920244583
                    ],
                    [
                        23.85878562927246,
                        38.02064392647901
                    ],
                    [
                        23.85234832763672,
                        38.021184856175935
                    ],
                    [
                        23.833723068237305,
                        38.02422751132024
                    ],
                    [
                        23.820676803588864,
                        38.02179339731211
                    ],
                    [
                        23.81239414215088,
                        38.017127786121506
                    ],
                    [
                        23.81535530090332,
                        38.01564013749379
                    ],
                    [
                        23.815054893493652,
                        38.01523440990023
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933715820312496,
                        37.92443025672885
                    ],
                    [
                        23.924789428710938,
                        37.915763487770754
                    ],
                    [
                        23.901915550231934,
                        37.90858554667319
                    ],
                    [
                        23.898911476135254,
                        37.90919502170938
                    ],
                    [
                        23.888955116271973,
                        37.92412558295426
                    ],
                    [
                        23.886680603027344,
                        37.930692715762504
                    ],
                    [
                        23.88625144958496,
                        37.960034537393405
                    ],
                    [
                        23.88376235961914,
                        37.966124796192524
                    ],
                    [
                        23.87054443359375,
                        37.97945393307615
                    ],
                    [
                        23.869514465332028,
                        37.98303953134849
                    ],
                    [
                        23.87251853942871,
                        37.99359235100401
                    ],
                    [
                        23.872861862182617,
                        37.99508044703298
                    ],
                    [
                        23.87054443359375,
                        38.00326443553524
                    ],
                    [
                        23.87200355529785,
                        38.005090490153805
                    ],
                    [
                        23.860416412353516,
                        38.00725464414688
                    ],
                    [
                        23.858699798583984,
                        38.00752515890449
                    ],
                    [
                        23.853464126586914,
                        38.009012972229755
                    ],
                    [
                        23.84359359741211,
                        38.010636006876105
                    ],
                    [
                        23.84033203125,
                        38.010974134571214
                    ],
                    [
                        23.837499618530273,
                        38.01232662975551
                    ],
                    [
                        23.830375671386715,
                        38.01388196836781
                    ],
                    [
                        23.820419311523438,
                        38.01374672284204
                    ],
                    [
                        23.81535530090332,
                        38.01564013749379
                    ],
                    [
                        23.81509780883789,
                        38.015268220618815
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933715820312496,
                        37.92443025672885
                    ],
                    [
                        23.925819396972653,
                        37.91603433975963
                    ],
                    [
                        23.90264511108398,
                        37.90858554667319
                    ],
                    [
                        23.89904022216797,
                        37.90912730251023
                    ],
                    [
                        23.888568878173828,
                        37.924701076802094
                    ],
                    [
                        23.886337280273438,
                        37.93052346712617
                    ],
                    [
                        23.886337280273438,
                        37.960034537393405
                    ],
                    [
                        23.883419036865234,
                        37.966395462637834
                    ],
                    [
                        23.870716094970703,
                        37.97965689614654
                    ],
                    [
                        23.869342803955075,
                        37.983310135428795
                    ],
                    [
                        23.872604370117188,
                        37.99345706804981
                    ],
                    [
                        23.87277603149414,
                        37.99508044703298
                    ],
                    [
                        23.87002944946289,
                        38.00279100654415
                    ],
                    [
                        23.871746063232422,
                        38.005090490153805
                    ],
                    [
                        23.858613967895508,
                        38.00745753030866
                    ],
                    [
                        23.853464126586914,
                        38.009012972229755
                    ],
                    [
                        23.84359359741211,
                        38.0107712581413
                    ],
                    [
                        23.840503692626953,
                        38.01090650915695
                    ],
                    [
                        23.83732795715332,
                        38.01239425385966
                    ],
                    [
                        23.83046150207519,
                        38.01388196836781
                    ],
                    [
                        23.820440769195557,
                        38.01366219426174
                    ],
                    [
                        23.8158917427063,
                        38.012360441815375
                    ],
                    [
                        23.81162166595459,
                        38.011362979492546
                    ],
                    [
                        23.81160020828247,
                        38.01156585428486
                    ],
                    [
                        23.811943531036377,
                        38.01227591163642
                    ],
                    [
                        23.812201023101807,
                        38.012478783902154
                    ],
                    [
                        23.813853263854977,
                        38.01393268537562
                    ],
                    [
                        23.81509780883789,
                        38.015268220618815
                    ]
                ]
            }
        }
    ]
}];

var startCarLine = [{
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933029174804688,
                        37.9241594356582
                    ],
                    [
                        23.92547607421875,
                        37.915763487770754
                    ],
                    [
                        23.91303062438965,
                        37.9125809021964
                    ],
                    [
                        23.901958465576172,
                        37.9085178269131
                    ],
                    [
                        23.898782730102536,
                        37.9093304599207
                    ],
                    [
                        23.88891220092773,
                        37.9241594356582
                    ],
                    [
                        23.88676643371582,
                        37.9306588660664
                    ],
                    [
                        23.886165618896484,
                        37.960237554157786
                    ],
                    [
                        23.88376235961914,
                        37.9662601295399
                    ],
                    [
                        23.87054443359375,
                        37.979724550378606
                    ],
                    [
                        23.86977195739746,
                        37.98283657763338
                    ],
                    [
                        23.872604370117188,
                        37.99345706804981
                    ],
                    [
                        23.872861862182617,
                        37.99487752662492
                    ],
                    [
                        23.86908531188965,
                        38.007051757423675
                    ],
                    [
                        23.8677978515625,
                        38.01381434563611
                    ],
                    [
                        23.865909576416016,
                        38.016654446651685
                    ],
                    [
                        23.862476348876953,
                        38.01935920244583
                    ],
                    [
                        23.85878562927246,
                        38.02064392647901
                    ],
                    [
                        23.85234832763672,
                        38.021184856175935
                    ],
                    [
                        23.833723068237305,
                        38.02422751132024
                    ],
                    [
                        23.820676803588864,
                        38.02179339731211
                    ],
                    [
                        23.81239414215088,
                        38.017127786121506
                    ],
                    [
                        23.81535530090332,
                        38.01564013749379
                    ],
                    [
                        23.815054893493652,
                        38.01523440990023
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933715820312496,
                        37.92443025672885
                    ],
                    [
                        23.924789428710938,
                        37.915763487770754
                    ],
                    [
                        23.901915550231934,
                        37.90858554667319
                    ],
                    [
                        23.898911476135254,
                        37.90919502170938
                    ],
                    [
                        23.888955116271973,
                        37.92412558295426
                    ],
                    [
                        23.886680603027344,
                        37.930692715762504
                    ],
                    [
                        23.88625144958496,
                        37.960034537393405
                    ],
                    [
                        23.88376235961914,
                        37.966124796192524
                    ],
                    [
                        23.87054443359375,
                        37.97945393307615
                    ],
                    [
                        23.869514465332028,
                        37.98303953134849
                    ],
                    [
                        23.87251853942871,
                        37.99359235100401
                    ],
                    [
                        23.872861862182617,
                        37.99508044703298
                    ],
                    [
                        23.87054443359375,
                        38.00326443553524
                    ],
                    [
                        23.87200355529785,
                        38.005090490153805
                    ],
                    [
                        23.860416412353516,
                        38.00725464414688
                    ],
                    [
                        23.858699798583984,
                        38.00752515890449
                    ],
                    [
                        23.853464126586914,
                        38.009012972229755
                    ],
                    [
                        23.84359359741211,
                        38.010636006876105
                    ],
                    [
                        23.84033203125,
                        38.010974134571214
                    ],
                    [
                        23.837499618530273,
                        38.01232662975551
                    ],
                    [
                        23.830375671386715,
                        38.01388196836781
                    ],
                    [
                        23.820419311523438,
                        38.01374672284204
                    ],
                    [
                        23.81535530090332,
                        38.01564013749379
                    ],
                    [
                        23.81509780883789,
                        38.015268220618815
                    ]
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [
                        23.933715820312496,
                        37.92443025672885
                    ],
                    [
                        23.925819396972653,
                        37.91603433975963
                    ],
                    [
                        23.90264511108398,
                        37.90858554667319
                    ],
                    [
                        23.89904022216797,
                        37.90912730251023
                    ],
                    [
                        23.888568878173828,
                        37.924701076802094
                    ],
                    [
                        23.886337280273438,
                        37.93052346712617
                    ],
                    [
                        23.886337280273438,
                        37.960034537393405
                    ],
                    [
                        23.883419036865234,
                        37.966395462637834
                    ],
                    [
                        23.870716094970703,
                        37.97965689614654
                    ],
                    [
                        23.869342803955075,
                        37.983310135428795
                    ],
                    [
                        23.872604370117188,
                        37.99345706804981
                    ],
                    [
                        23.87277603149414,
                        37.99508044703298
                    ],
                    [
                        23.87002944946289,
                        38.00279100654415
                    ],
                    [
                        23.871746063232422,
                        38.005090490153805
                    ],
                    [
                        23.858613967895508,
                        38.00745753030866
                    ],
                    [
                        23.853464126586914,
                        38.009012972229755
                    ],
                    [
                        23.84359359741211,
                        38.0107712581413
                    ],
                    [
                        23.840503692626953,
                        38.01090650915695
                    ],
                    [
                        23.83732795715332,
                        38.01239425385966
                    ],
                    [
                        23.83046150207519,
                        38.01388196836781
                    ],
                    [
                        23.820440769195557,
                        38.01366219426174
                    ],
                    [
                        23.8158917427063,
                        38.012360441815375
                    ],
                    [
                        23.81162166595459,
                        38.011362979492546
                    ],
                    [
                        23.81160020828247,
                        38.01156585428486
                    ],
                    [
                        23.811943531036377,
                        38.01227591163642
                    ],
                    [
                        23.812201023101807,
                        38.012478783902154
                    ],
                    [
                        23.813853263854977,
                        38.01393268537562
                    ],
                    [
                        23.81509780883789,
                        38.015268220618815
                    ]
                ]
            }
        }
    ]
}];

var startBusLine = [
    {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "LineString",
                    "coordinates": [
                        [
                            23.933029174804688,
                            37.9241594356582
                        ],
                        [
                            23.92547607421875,
                            37.915763487770754
                        ],
                        [
                            23.91303062438965,
                            37.9125809021964
                        ],
                        [
                            23.901958465576172,
                            37.9085178269131
                        ],
                        [
                            23.898782730102536,
                            37.9093304599207
                        ],
                        [
                            23.88891220092773,
                            37.9241594356582
                        ],
                        [
                            23.88676643371582,
                            37.9306588660664
                        ],
                        [
                            23.886165618896484,
                            37.960237554157786
                        ],
                        [
                            23.88376235961914,
                            37.9662601295399
                        ],
                        [
                            23.87054443359375,
                            37.979724550378606
                        ],
                        [
                            23.86977195739746,
                            37.98283657763338
                        ],
                        [
                            23.872604370117188,
                            37.99345706804981
                        ],
                        [
                            23.872861862182617,
                            37.99487752662492
                        ],
                        [
                            23.86908531188965,
                            38.007051757423675
                        ],
                        [
                            23.8677978515625,
                            38.01381434563611
                        ],
                        [
                            23.865909576416016,
                            38.016654446651685
                        ],
                        [
                            23.862476348876953,
                            38.01935920244583
                        ],
                        [
                            23.85878562927246,
                            38.02064392647901
                        ],
                        [
                            23.85234832763672,
                            38.021184856175935
                        ],
                        [
                            23.833723068237305,
                            38.02422751132024
                        ],
                        [
                            23.820676803588864,
                            38.02179339731211
                        ],
                        [
                            23.81239414215088,
                            38.017127786121506
                        ],
                        [
                            23.81535530090332,
                            38.01564013749379
                        ],
                        [
                            23.815054893493652,
                            38.01523440990023
                        ]
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "LineString",
                    "coordinates": [
                        [
                            23.933715820312496,
                            37.92443025672885
                        ],
                        [
                            23.924789428710938,
                            37.915763487770754
                        ],
                        [
                            23.901915550231934,
                            37.90858554667319
                        ],
                        [
                            23.898911476135254,
                            37.90919502170938
                        ],
                        [
                            23.888955116271973,
                            37.92412558295426
                        ],
                        [
                            23.886680603027344,
                            37.930692715762504
                        ],
                        [
                            23.88625144958496,
                            37.960034537393405
                        ],
                        [
                            23.88376235961914,
                            37.966124796192524
                        ],
                        [
                            23.87054443359375,
                            37.97945393307615
                        ],
                        [
                            23.869514465332028,
                            37.98303953134849
                        ],
                        [
                            23.87251853942871,
                            37.99359235100401
                        ],
                        [
                            23.872861862182617,
                            37.99508044703298
                        ],
                        [
                            23.87054443359375,
                            38.00326443553524
                        ],
                        [
                            23.87200355529785,
                            38.005090490153805
                        ],
                        [
                            23.860416412353516,
                            38.00725464414688
                        ],
                        [
                            23.858699798583984,
                            38.00752515890449
                        ],
                        [
                            23.853464126586914,
                            38.009012972229755
                        ],
                        [
                            23.84359359741211,
                            38.010636006876105
                        ],
                        [
                            23.84033203125,
                            38.010974134571214
                        ],
                        [
                            23.837499618530273,
                            38.01232662975551
                        ],
                        [
                            23.830375671386715,
                            38.01388196836781
                        ],
                        [
                            23.820419311523438,
                            38.01374672284204
                        ],
                        [
                            23.81535530090332,
                            38.01564013749379
                        ],
                        [
                            23.81509780883789,
                            38.015268220618815
                        ]
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "LineString",
                    "coordinates": [
                        [
                            23.933715820312496,
                            37.92443025672885
                        ],
                        [
                            23.925819396972653,
                            37.91603433975963
                        ],
                        [
                            23.90264511108398,
                            37.90858554667319
                        ],
                        [
                            23.89904022216797,
                            37.90912730251023
                        ],
                        [
                            23.888568878173828,
                            37.924701076802094
                        ],
                        [
                            23.886337280273438,
                            37.93052346712617
                        ],
                        [
                            23.886337280273438,
                            37.960034537393405
                        ],
                        [
                            23.883419036865234,
                            37.966395462637834
                        ],
                        [
                            23.870716094970703,
                            37.97965689614654
                        ],
                        [
                            23.869342803955075,
                            37.983310135428795
                        ],
                        [
                            23.872604370117188,
                            37.99345706804981
                        ],
                        [
                            23.87277603149414,
                            37.99508044703298
                        ],
                        [
                            23.87002944946289,
                            38.00279100654415
                        ],
                        [
                            23.871746063232422,
                            38.005090490153805
                        ],
                        [
                            23.858613967895508,
                            38.00745753030866
                        ],
                        [
                            23.853464126586914,
                            38.009012972229755
                        ],
                        [
                            23.84359359741211,
                            38.0107712581413
                        ],
                        [
                            23.840503692626953,
                            38.01090650915695
                        ],
                        [
                            23.83732795715332,
                            38.01239425385966
                        ],
                        [
                            23.83046150207519,
                            38.01388196836781
                        ],
                        [
                            23.820440769195557,
                            38.01366219426174
                        ],
                        [
                            23.8158917427063,
                            38.012360441815375
                        ],
                        [
                            23.81162166595459,
                            38.011362979492546
                        ],
                        [
                            23.81160020828247,
                            38.01156585428486
                        ],
                        [
                            23.811943531036377,
                            38.01227591163642
                        ],
                        [
                            23.812201023101807,
                            38.012478783902154
                        ],
                        [
                            23.813853263854977,
                            38.01393268537562
                        ],
                        [
                            23.81509780883789,
                            38.015268220618815
                        ]
                    ]
                }
            }
        ]
    }];

//end GeoJSON file
var startCarLineStyle = {
    "color": "red",
    "weight": 5,
    "opacity": 0.65
};

var startTrainLineStyle = {
    "color": "green",
    "weight": 5,
    "opacity": 0.65
};

var startBusLineStyle = {
    "color": "blue",
    "weight": 5,
    "opacity": 0.65
};
// uncomment the style line to see style working.
var startCarLineFeatureLayer = L.geoJSON(startCarLine, {
    style: startCarLineStyle
});

var startTrainLineFeatureLayer = L.geoJSON(startTrainLine, {
    style: startTrainLineStyle
});

var startBusLineFeatureLayer = L.geoJSON(startBusLine, {
    style: startBusLineStyle
});

// load a tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    {
        attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
        zoom: 15,
        subdomains: 'abc',
        minZoom: 0,
        maxZoom: 20,
        ext: 'png'
    }
).addTo(mapStop);

var LeafIcon = L.Icon.extend({
    options: {
        shadowUrl: 'assets/icon/marker-icon-green.png',
        iconAnchor: [12, 40]
    }
});

var LeafIcon = L.Icon.extend({
    options: {
        shadowUrl: 'assets/icon/marker-icon-green.png',
        iconAnchor: [12, 40]
    }
});

var destIcon = new LeafIcon({iconUrl: 'leaf-orange.png'});
var startIcon = new LeafIcon({iconUrl: 'leaf-orange.png'});

L.marker([37.9241594356582, 23.933029174804688], {icon: destIcon}).addTo(mapStop);

$(document).ready(function () {
    console.log('whatever');
});

//show or hide table row details
$(".table-row").click(function () {
    var transportType = $(this).data("transport-type");
    hideAllLayer();
    if ($(this).find('.table-row-details').is(":hidden")) {
        $('.table-row').not(this).each(function () {
            hideDetails.call(this);
        });
        $(this).find('.table-row-details').slideDown("slow");
        $(this).find('.table-row-details').css("display", "grid");
        showLayer($(this), transportType);
    } else {
        hideDetails.call(this);
        hideAllLayer();
    }
});


$("#start-point-input").on("focusout", function () {
    console.info("focusout");
    $("#table").slideDown('slow');
    $("#info-form").slideDown('slow');
    L.marker([38.011396791996916, 23.811385631561276], {icon: destIcon}).addTo(mapStop);
});

function hideAllLayer() {
    mapStop.removeLayer(startBusLineFeatureLayer);
    mapStop.removeLayer(startCarLineFeatureLayer);
    mapStop.removeLayer(startCarLineFeatureLayer);
    mapStop.removeLayer(startTrainLineFeatureLayer);
}

function showLayer(element, transportType) {
    console.info("showL " + transportType);
    switch (transportType) {
        case TRANSPORT_TYPE.BUS:
            console.info("BUS");
            mapStop.addLayer(startBusLineFeatureLayer);
            break;
        case TRANSPORT_TYPE.CAR:
            console.info("CAR");
            mapStop.addLayer(startCarLineFeatureLayer);
            break;
        case TRANSPORT_TYPE.ECAR:
            console.info("ECAR");
            mapStop.addLayer(startCarLineFeatureLayer);
            break;
        case TRANSPORT_TYPE.TRAIN:
            console.info("TRAIN");
            mapStop.addLayer(startTrainLineFeatureLayer);
            break;
        default:
            console.info("todo")
    }
}

function hideDetails() {
    $(this).find('.table-row-details').slideUp("slow");
}

$(function () {
    var startPointsTAG = [
        "Ag. Paraskevi Mesogion 318-322"
    ];

    var endPointTAG = [
        "Frankfurt Airport Main",
        "Frankfurt Airport East"
    ];

    $("#end-point-input").autocomplete({
        source: endPointTAG
    });
    $("#start-point-input").autocomplete({
        source: startPointsTAG
    });
});
